from flask import Flask, url_for, render_template, request, jsonify
from geopy import distance
from gmplot import gmplot

app = Flask(__name__)
gm = gmplot

# FIXME: delete this when compute_path is fixed
test_data = [
    (3.121120, 101.653580),
    (3.121120, 101.653510),
    (3.121050, 101.653510),
    (3.120330, 101.653510),
    (3.120110, 101.653520),
    (3.120040, 101.653530),
    (3.119750, 101.653710),
    (3.119620, 101.653820),
    (3.119510, 101.653950),
    (3.119400, 101.654160),
    (3.119360, 101.654260),
    (3.119370, 101.654390),
    (3.119400, 101.654480),
    (3.119450, 101.654540),
    (3.119490, 101.654590),
    (3.119800, 101.654610),
    (3.120210, 101.654610),
    (3.121000, 101.654600),
    (3.121260, 101.654590),
    (3.121320, 101.654620),
    (3.121390, 101.654660),
    (3.121440, 101.654710),
    (3.121500, 101.654760),
    (3.121550, 101.654900),
    (3.121600, 101.655000),
    (3.121670, 101.655130),
    (3.121790, 101.655380),
    (3.121820, 101.655490),
    (3.121840, 101.655720),
    (3.121810, 101.656970),
    (3.121800, 101.657490),
    (3.121740, 101.658000),
    (3.121660, 101.658380),
    (3.121620, 101.658700),
    (3.121640, 101.658980),
    (3.121780, 101.659710),
    (3.121790, 101.659940),
    (3.121730, 101.660120),
    (3.121670, 101.660260),
    (3.121480, 101.660450),
    (3.121300, 101.660550),
    (3.120720, 101.660700),
    (3.120440, 101.660790),
    (3.120390, 101.660820),
    (3.120280, 101.660880),
    (3.120200, 101.660940),
    (3.120130, 101.661030),
    (3.119800, 101.661640),
    (3.119680, 101.661790),
    (3.119520, 101.661930),
    (3.119230, 101.662130),
    (3.119000, 101.662230),
    (3.118890, 101.662300),
    (3.118850, 101.662340),
    (3.118820, 101.662390),
    (3.118820, 101.662600),
    (3.118780, 101.662960),
    (3.118690, 101.663460),
    (3.118680, 101.663570),
    (3.118730, 101.663660),
    (3.118810, 101.663810),
    (3.118830, 101.663900),
    (3.118770, 101.663990),
    (3.118660, 101.664120),
    (3.118550, 101.664210),
    (3.118500, 101.664540),
    (3.118400, 101.665060),
    (3.118350, 101.665280),
    (3.118250, 101.665280),
    (3.118190, 101.665280),
    (3.118100, 101.665230),
    (3.118010, 101.665110),
    (3.117950, 101.664760),
    (3.117820, 101.664190),
    (3.117690, 101.663870),
    (3.117640, 101.663810),
    (3.117560, 101.663720),
    (3.117430, 101.663530),
    (3.117100, 101.663190),
    (3.116620, 101.662850),
    (3.116200, 101.662670),
    (3.116050, 101.662650),
    (3.115770, 101.662640),
    (3.114910, 101.662670),
    (3.114290, 101.662620),
    (3.113890, 101.662540),
    (3.112920, 101.662390),
    (3.112360, 101.662330),
    (3.112140, 101.662330),
    (3.111860, 101.662410),
    (3.111520, 101.662570),
    (3.111430, 101.662630),
    (3.111260, 101.662810),
    (3.111030, 101.663070),
    (3.110640, 101.663570),
    (3.110450, 101.663820),
    (3.110350, 101.664000),
    (3.110280, 101.664140),
    (3.110210, 101.664340),
    (3.110140, 101.664620),
    (3.110130, 101.664740),
    (3.110120, 101.665180),
    (3.110100, 101.666720),
    (3.110100, 101.667240),
    (3.110050, 101.667560),
    (3.109980, 101.667720),
    (3.109880, 101.667860),
    (3.109810, 101.667940),
    (3.109630, 101.668080),
    (3.109540, 101.668110),
    (3.109560, 101.668160),
    (3.109540, 101.668110),
    (3.109500, 101.668120),
    (3.109390, 101.668160),
    (3.109150, 101.668200),
    (3.108800, 101.668240),
    (3.108490, 101.668220),
    (3.108390, 101.668220),
    (3.108400, 101.668100),
    (3.108390, 101.667380),
    (3.108390, 101.667020),
    (3.108370, 101.666240),
    (3.108370, 101.666230),
]


def compute_path(start, end):
    # FIXME: replace with actual code.
    return test_data


@app.route("/", methods=['POST', 'GET'])
def root():
    if request.method == 'POST':
        start = request.form['start']
        end = request.form['end']

        if start and end:
            result = compute_path(start, end)
            return jsonify({'data': result})

        return jsonify({'error': 'Missing input!'})
    else:
        return render_template("index.html")


if __name__ == '__main__':
    app.run(debug=True)
